<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–ò–Ω–≤–æ–π—Å ‚Äî Wilson & Myers Appliance Repairs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        * { box-sizing: border-box; }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 20px;
            background: #e5e7eb;
            color: #111827;
            display: flex;
            justify-content: center;
        }

        .page {
            width: 100%;
            max-width: 1200px;
            background: #f9fafb;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.25);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .logo-block {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: 2px solid #0f766e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 18px;
            color: #0f766e;
            background: #ecfdf5;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-weight: 700;
            letter-spacing: 0.02em;
        }

        .logo-sub {
            font-size: 12px;
            color: #6b7280;
        }

        .mode-block {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .mode-switcher {
            display: flex;
            gap: 8px;
        }

        .mode-btn {
            border-radius: 999px;
            border: 1px solid #d1d5db;
            padding: 6px 14px;
            font-size: 13px;
            background: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .mode-btn span {
            font-size: 18px;
        }

        .mode-btn.active {
            background: #0f766e;
            color: #ecfdf5;
            border-color: #0f766e;
        }

        .mode-note {
            font-size: 11px;
            color: #4b5563;
            text-align: right;
            max-width: 260px;
            line-height: 1.3;
        }

        .page-body {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
            gap: 20px;
        }

        @media (max-width: 960px) {
            .page-body { grid-template-columns: 1fr; }
            .mode-block { align-items: flex-start; }
            .mode-note { text-align: left; }
        }

        .card {
            background: #ffffff;
            border-radius: 14px;
            padding: 16px 18px;
            border: 1px solid #e5e7eb;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title small {
            font-weight: 400;
            color: #6b7280;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-bottom: 8px;
        }

        .field label {
            font-size: 12px;
            color: #4b5563;
        }

        .field input {
            border-radius: 10px;
            border: 1px solid #d1d5db;
            padding: 7px 9px;
            font-size: 13px;
            width: 100%;
            background: #f9fafb;
        }

        .field input:focus {
            outline: none;
            border-color: #0f766e;
            box-shadow: 0 0 0 1px rgba(15,118,110,0.25);
        }

        .field-row {
            display: grid;
            grid-template-columns: 1.5fr 0.9fr 0.9fr;
            gap: 8px;
            align-items: center;
        }

        .btn-main {
            margin-top: 10px;
            width: 100%;
            border-radius: 999px;
            border: none;
            background: #0f766e;
            color: #ecfdf5;
            padding: 9px 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-main:hover {
            background: #115e59;
        }

        .invoice-preview {
            background: #ffffff;
            border-radius: 14px;
            border: 1px solid #e5e7eb;
            padding: 18px 18px 22px;
        }

        .inv-header {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 12px;
        }

        .inv-company { font-weight: 600; }

        .inv-sub {
            font-size: 12px;
            color: #6b7280;
        }

        .inv-meta {
            font-size: 12px;
            color: #4b5563;
            text-align: right;
        }

        .inv-meta div { line-height: 1.4; }

        .inv-billto {
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 10px 12px;
            font-size: 12px;
            margin-bottom: 12px;
        }

        .inv-billto strong {
            font-size: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 6px 4px;
            border-bottom: 1px solid #e5e7eb;
            text-align: right;
        }

        th:first-child, td:first-child { text-align: left; }
        th:nth-child(2), td:nth-child(2) { text-align: center; }

        .inv-summary {
            width: 260px;
            margin-left: auto;
            font-size: 12px;
            margin-top: 10px;
        }

        .inv-summary div {
            display: flex;
            justify-content: space-between;
            padding: 2px 0;
        }

        .inv-grand {
            font-weight: 700;
            border-top: 1px solid #e5e7eb;
            margin-top: 3px;
            padding-top: 4px;
        }

        .sign-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 26px;
            font-size: 11px;
            color: #6b7280;
        }

        .sign-line {
            border-top: 1px solid #d1d5db;
            margin-top: 28px;
        }

        .sign-label { margin-top: 4px; }

        .mode-hint {
            font-size: 11px;
            color: #6b7280;
            margin-left: 6px;
        }

        .easy-note {
            font-size: 12px;
            color: #374151;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
<div class="page">
    <div class="page-header">
        <div class="logo-block">
            <div class="logo-icon">W&amp;M</div>
            <div class="logo-text">
                <div class="logo-title">Wilson &amp; Myers Appliance Repairs</div>
                <div class="logo-sub">Professional Appliance Service &amp; Repair</div>
            </div>
        </div>
        <div class="mode-block">
            <div class="mode-switcher">
                <button type="button" class="mode-btn active" id="btnModeFull">
                    <span>üìÑ</span> FULL
                </button>
                <button type="button" class="mode-btn" id="btnModeEasy">
                    <span>‚ö°</span> EASY
                </button>
            </div>
            <div class="mode-note">
                FULL ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π –∏–Ω–≤–æ–π—Å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞, –ø–µ—á–∞—Ç–∏ –∏ PDF.<br>
                EASY ‚Äî –±—ã—Å—Ç—Ä—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, —Ç–æ–ª—å–∫–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É.
            </div>
        </div>
    </div>

    <div class="page-body">
        <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: —Ñ–æ—Ä–º—ã -->
        <div class="card">
            <!-- FULL MODE FORM -->
            <div id="fullForm">
                <div class="card-title">
                    –ò–Ω–≤–æ–π—Å (FULL)
                    <small>–í–µ—Ä—Å–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏/PDF –∏ –ø–æ–∫–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç—É.</small>
                </div>

                <div class="grid-2">
                    <div class="field">
                        <label>–ö–æ–º–ø–∞–Ω–∏—è</label>
                        <input id="companyName" type="text" value="Wilson &amp; Myers Appliance Repairs" />
                    </div>
                    <div class="field">
                        <label>–ù–æ–º–µ—Ä –∏–Ω–≤–æ–π—Å–∞</label>
                        <input id="invoiceNumber" type="text" value="6551" />
                    </div>
                </div>

                <div class="grid-2">
                    <div class="field">
                        <label>–î–∞—Ç–∞</label>
                        <input id="invoiceDate" type="date" />
                    </div>
                    <div class="field">
                        <label>–¢–µ—Ö–Ω–∏–∫ (–∏–º—è)</label>
                        <input id="technicianName" type="text" value="Technician" />
                    </div>
                </div>

                <div class="grid-2">
                    <div class="field">
                        <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
                        <input id="clientName" type="text" />
                    </div>
                    <div class="field">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</label>
                        <input id="clientPhone" type="text" />
                    </div>
                </div>

                <div class="field">
                    <label>–ê–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞</label>
                    <input id="clientAddress" type="text" />
                </div>

                <div class="field">
                    <label>–ñ–µ–ª–∞–µ–º–∞—è —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å ($)</label>
                    <input id="desiredProfit" type="number" inputmode="decimal" min="0" value="200" />
                </div>

                <div class="card-title" style="margin-top:12px;">
                    –î–µ—Ç–∞–ª–∏ (Parts)
                    <small>–ó–∞–ø–æ–ª–Ω–∏ —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –æ–ø–ª–∞—á–∏–≤–∞–µ–º—É—é —Ü–µ–Ω—É –¥–µ—Ç–∞–ª–µ–π</small>
                </div>

                <!-- –ü—è—Ç—å —Å—Ç—Ä–æ–∫ –¥–µ—Ç–∞–ª–µ–π -->
                <div id="partsFull">
                    <div class="field">
                        <div class="field-row">
                            <div>
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ 1</label>
                                <input id="p1Name" type="text" value="Part 1" />
                            </div>
                            <div>
                                <label>–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 1 ($)</label>
                                <input id="p1Real" type="number" inputmode="decimal" min="0" step="0.01" />
                            </div>
                            <div>
                                <label>Qty</label>
                                <input id="p1Qty" type="number" value="1" min="0" />
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <div class="field-row">
                            <div>
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ 2</label>
                                <input id="p2Name" type="text" value="Part 2" />
                            </div>
                            <div>
                                <label>–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 2 ($)</label>
                                <input id="p2Real" type="number" inputmode="decimal" min="0" step="0.01" />
                            </div>
                            <div>
                                <label>Qty</label>
                                <input id="p2Qty" type="number" value="1" min="0" />
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <div class="field-row">
                            <div>
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ 3</label>
                                <input id="p3Name" type="text" value="Part 3" />
                            </div>
                            <div>
                                <label>–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 3 ($)</label>
                                <input id="p3Real" type="number" inputmode="decimal" min="0" step="0.01" />
                            </div>
                            <div>
                                <label>Qty</label>
                                <input id="p3Qty" type="number" value="1" min="0" />
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <div class="field-row">
                            <div>
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ 4</label>
                                <input id="p4Name" type="text" value="Part 4" />
                            </div>
                            <div>
                                <label>–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 4 ($)</label>
                                <input id="p4Real" type="number" inputmode="decimal" min="0" step="0.01" />
                            </div>
                            <div>
                                <label>Qty</label>
                                <input id="p4Qty" type="number" value="1" min="0" />
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <div class="field-row">
                            <div>
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ 5</label>
                                <input id="p5Name" type="text" value="Part 5" />
                            </div>
                            <div>
                                <label>–†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ 5 ($)</label>
                                <input id="p5Real" type="number" inputmode="decimal" min="0" step="0.01" />
                            </div>
                            <div>
                                <label>Qty</label>
                                <input id="p5Qty" type="number" value="1" min="0" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="field" style="margin-top:6px;">
                    <label>–°—Ç–∞–≤–∫–∞ –Ω–∞–ª–æ–≥–∞ –Ω–∞ –¥–µ—Ç–∞–ª–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7.96%)</label>
                    <input id="taxRate" type="number" inputmode="decimal" value="7.96" />
                </div>

                <button class="btn-main" id="btnGenerateFull">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–æ–π—Å (FULL)</button>
            </div>

            <!-- EASY MODE FORM -->
            <div id="easyForm" style="display:none;">
                <div class="card-title">
                    –ë—ã—Å—Ç—Ä—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (EASY)
                    <small>–í–µ—Ä—Å–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã, –±–µ–∑ –ø–µ—á–∞—Ç–∏.</small>
                </div>
                <p class="easy-note">
                    –û—Ç–≤–µ—á–∞–µ—à—å —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–≤–∞ –≤–æ–ø—Ä–æ—Å–∞: <br />
                    1) –°–∫–æ–ª—å–∫–æ —Ö–æ—á–µ—à—å <b>—á–∏—Å—Ç—ã–º–∏</b>?<br />
                    2) –°–∫–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–æ—è—Ç –¥–µ—Ç–∞–ª–∏ (–¥–æ 5 —à—Ç—É–∫)?<br />
                    –î–∞–ª—å—à–µ —Å—á–∏—Ç–∞–µ–º Parts, –Ω–∞–ª–æ–≥ –Ω–∞ Parts –∏ Labor –ø–æ —Ñ–æ—Ä–º—É–ª–µ.
                </p>

                <div class="field">
                    <label>–ñ–µ–ª–∞–µ–º–∞—è —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å ($)</label>
                    <input id="easyProfit" type="number" inputmode="decimal" min="0" value="200" />
                </div>

                <div class="card-title" style="margin-top:10px;">
                    –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –¥–µ—Ç–∞–ª–µ–π
                    <span class="mode-hint">(–º–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å 1‚Äì5 —à—Ç—É–∫)</span>
                </div>

                <div class="grid-2">
                    <div class="field">
                        <label>–î–µ—Ç–∞–ª—å 1 ($)</label>
                        <input id="e1Real" type="number" inputmode="decimal" min="0" step="0.01" />
                    </div>
                    <div class="field">
                        <label>–î–µ—Ç–∞–ª—å 2 ($)</label>
                        <input id="e2Real" type="number" inputmode="decimal" min="0" step="0.01" />
                    </div>
                </div>
                <div class="grid-2">
                    <div class="field">
                        <label>–î–µ—Ç–∞–ª—å 3 ($)</label>
                        <input id="e3Real" type="number" inputmode="decimal" min="0" step="0.01" />
                    </div>
                    <div class="field">
                        <label>–î–µ—Ç–∞–ª—å 4 ($)</label>
                        <input id="e4Real" type="number" inputmode="decimal" min="0" step="0.01" />
                    </div>
                </div>
                <div class="field">
                    <label>–î–µ—Ç–∞–ª—å 5 ($)</label>
                    <input id="e5Real" type="number" inputmode="decimal" min="0" step="0.01" />
                </div>

                <div class="field">
                    <label>–°—Ç–∞–≤–∫–∞ –Ω–∞–ª–æ–≥–∞ –Ω–∞ –¥–µ—Ç–∞–ª–∏ (%, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7.96)</label>
                    <input id="easyTaxRate" type="number" inputmode="decimal" value="7.96" />
                </div>

                <button class="btn-main" id="btnGenerateEasy">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ñ–æ—Ä–º—É–ª–µ (EASY)</button>
            </div>
        </div>

        <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ø—Ä–µ–≤—å—é –∏–Ω–≤–æ–π—Å–∞ -->
        <div class="invoice-preview" id="invoicePreview">
            <div class="inv-header">
                <div>
                    <div class="inv-company" id="outCompany">Wilson &amp; Myers Appliance Repairs</div>
                    <div class="inv-sub">Appliance Repair</div>
                </div>
                <div class="inv-meta">
                    <div>Invoice #: <span id="outInvoiceNumber">‚Äî</span></div>
                    <div>Date: <span id="outInvoiceDate">‚Äî</span></div>
                </div>
            </div>

            <div class="inv-billto" id="outBillTo">
                <strong>Bill To:</strong><br />
                <span id="outClientName">Client Name</span><br />
                <span id="outClientPhone"></span><br />
                <span id="outClientAddress"></span>
            </div>

            <table>
                <thead>
                <tr>
                    <th>Description</th>
                    <th>Qty</th>
                    <th>Unit</th>
                    <th>Tax</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody id="invBody">
                <!-- —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </tbody>
            </table>

            <div class="inv-summary">
                <div>
                    <span>Subtotal</span>
                    <span id="outSubtotal">$0.00</span>
                </div>
                <div>
                    <span>Tax (7.96% Parts)</span>
                    <span id="outTax">$0.00</span>
                </div>
                <div class="inv-grand">
                    <span>Grand Total</span>
                    <span id="outGrandTotal">$0.00</span>
                </div>
            </div>

            <div class="sign-row">
                <div>
                    <div class="sign-line"></div>
                    <div class="sign-label">Technician Signature</div>
                </div>
                <div>
                    <div class="sign-line"></div>
                    <div class="sign-label">Customer Signature</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
(function () {
    const taxInput = document.getElementById("taxRate");
    const easyTaxInput = document.getElementById("easyTaxRate");

    // —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞
    const dateInput = document.getElementById("invoiceDate");
    const today = new Date();
    dateInput.value = today.toISOString().slice(0, 10);

    // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ FULL / EASY
    const btnFull = document.getElementById("btnModeFull");
    const btnEasy = document.getElementById("btnModeEasy");
    const fullForm = document.getElementById("fullForm");
    const easyForm = document.getElementById("easyForm");

    btnFull.addEventListener("click", function () {
        btnFull.classList.add("active");
        btnEasy.classList.remove("active");
        fullForm.style.display = "block";
        easyForm.style.display = "none";
    });

    btnEasy.addEventListener("click", function () {
        btnEasy.classList.add("active");
        btnFull.classList.remove("active");
        fullForm.style.display = "none";
        easyForm.style.display = "block";
    });

    function toNumber(v) {
        const n = parseFloat(v);
        return isNaN(n) ? 0 : n;
    }

    function formatMoney(v) {
        return "$" + v.toFixed(2);
    }

    // –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
    function calculateInvoice(partsReal, desiredProfit, taxPercent) {
        const TAX_RATE = taxPercent / 100;
        const realPartsTotal = partsReal.reduce((s, v) => s + v, 0);

        // –§–æ—Ä–º—É–ª–∞:
        // GrandTotalBase = —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å * 2 + —Å—É–º–º–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–µ—Ç–∞–ª–µ–π + 20
        let grandTotalBase = desiredProfit * 2 + realPartsTotal + 20;

        // –µ—Å–ª–∏ –¥–µ—Ç–∞–ª–µ–π –Ω–µ—Ç ‚Äî —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∏—Ç—å –Ω–æ–ª—å
        if (partsReal.length === 0) {
            // –≤—Å—ë —É—Ö–æ–¥–∏—Ç –≤ Labor, –Ω–æ –¥–µ–ª–∞–µ–º –≤–∏–¥, —á—Ç–æ –µ—Å—Ç—å –æ–¥–Ω–∞ "Part"
            const partsSellTotal = 0;
            const partsTax = 0;
            const labor = Math.round(grandTotalBase);
            return {
                realPartsTotal,
                partsSellTotal,
                partsTax,
                labor,
                grandTotal: labor,
                taxRate: TAX_RATE
            };
        }

        // –î–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞–µ–º –Ω–∞—Ü–µ–Ω–∫—É –Ω–∞ –¥–µ—Ç–∞–ª–∏,
        // –æ—Å—Ç–∞–ª—å–Ω–æ–µ —É—Ö–æ–¥–∏—Ç –≤ Labor
        let factor = 4.0;
        function computeForFactor(f) {
            const p = realPartsTotal * f;
            const t = p * TAX_RATE;
            const l = grandTotalBase - (p + t);
            return { p, t, l };
        }

        let attempt = computeForFactor(factor);
        if (attempt.l < 50) {
            factor = 3.0;
            attempt = computeForFactor(factor);
        }
        if (attempt.l < 0) {
            factor = 2.0;
            attempt = computeForFactor(factor);
        }

        let partsSellTotal = attempt.p;
        let partsTax = attempt.t;
        let labor = attempt.l;

        // ‚õî Parts –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–≤–∞—é—Ç —Ä–æ–≤–Ω—ã–º–∏.
        // –ï—Å–ª–∏ —Å—É–º–º–∞ —Ä–æ–≤–Ω–∞—è ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–µ–Ω—Ç—ã –æ—Ç $0.01 –¥–æ $0.95
        const cents = partsSellTotal - Math.floor(partsSellTotal);
        if (Math.abs(cents) < 0.001) {
            const randomCents = (Math.floor(Math.random() * 95) + 1) / 100;
            partsSellTotal += randomCents;
        }

        // –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–∞–ª–æ–≥ –∏ —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
        partsTax = partsSellTotal * TAX_RATE;
        labor = grandTotalBase - (partsSellTotal + partsTax);

        // –û–∫—Ä—É–≥–ª—è–µ–º —Ä–∞–±–æ—Ç—É –¥–æ —Ü–µ–ª–æ–≥–æ –¥–æ–ª–ª–∞—Ä–∞
        labor = Math.round(labor);

        // –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π Grand Total
        const grandTotal = partsSellTotal + partsTax + labor;

        return {
            realPartsTotal,
            partsSellTotal,
            partsTax,
            labor,
            grandTotal,
            taxRate: TAX_RATE
        };
    }

    function renderInvoice(partsNames, calc, clientData, invoiceMeta) {
        const tbody = document.getElementById("invBody");
        tbody.innerHTML = "";

        const count = partsNames.length || 1;
        const singlePartPrice = calc.partsSellTotal / count;

        partsNames.forEach(function (name) {
            const tr = document.createElement("tr");

            const tdDesc = document.createElement("td");
            tdDesc.textContent = name;

            const tdQty = document.createElement("td");
            tdQty.textContent = "1";

            const tdUnit = document.createElement("td");
            tdUnit.textContent = formatMoney(singlePartPrice);

            const tdTax = document.createElement("td");
            tdTax.textContent = formatMoney(singlePartPrice * calc.taxRate);

            const tdTotal = document.createElement("td");
            tdTotal.textContent = formatMoney(singlePartPrice * (1 + calc.taxRate));

            tr.appendChild(tdDesc);
            tr.appendChild(tdQty);
            tr.appendChild(tdUnit);
            tr.appendChild(tdTax);
            tr.appendChild(tdTotal);
            tbody.appendChild(tr);
        });

        // Labor
        const trLabor = document.createElement("tr");
        const tdDescL = document.createElement("td");
        tdDescL.textContent = "Labor ‚Äì Work performed";

        const tdQtyL = document.createElement("td");
        tdQtyL.textContent = "1";

        const tdUnitL = document.createElement("td");
        tdUnitL.textContent = formatMoney(calc.labor);

        const tdTaxL = document.createElement("td");
        tdTaxL.textContent = "‚Äî";

        const tdTotalL = document.createElement("td");
        tdTotalL.textContent = formatMoney(calc.labor);

        trLabor.appendChild(tdDescL);
        trLabor.appendChild(tdQtyL);
        trLabor.appendChild(tdUnitL);
        trLabor.appendChild(tdTaxL);
        trLabor.appendChild(tdTotalL);
        tbody.appendChild(trLabor);

        // —à–∞–ø–∫–∞ –∏ –∏—Ç–æ–≥–∏
        document.getElementById("outCompany").textContent = invoiceMeta.company;
        document.getElementById("outInvoiceNumber").textContent = invoiceMeta.number || "‚Äî";
        document.getElementById("outInvoiceDate").textContent = invoiceMeta.date || "‚Äî";

        document.getElementById("outClientName").textContent = clientData.name || "Client Name";
        document.getElementById("outClientPhone").textContent = clientData.phone || "";
        document.getElementById("outClientAddress").textContent = clientData.address || "";

        const subtotal = calc.partsSellTotal + calc.labor;
        document.getElementById("outSubtotal").textContent = formatMoney(subtotal);
        document.getElementById("outTax").textContent = formatMoney(calc.partsTax);
        document.getElementById("outGrandTotal").textContent = formatMoney(calc.grandTotal);
    }

    // FULL —Ä–µ–∂–∏–º
    document.getElementById("btnGenerateFull").addEventListener("click", function () {
        const desiredProfit = toNumber(document.getElementById("desiredProfit").value);
        const tRate = toNumber(taxInput.value || "7.96");

        const partReals = [];
        const partNames = [];

        for (let i = 1; i <= 5; i++) {
            const real = toNumber(document.getElementById("p" + i + "Real").value);
            const qty = toNumber(document.getElementById("p" + i + "Qty").value || "1");
            if (real > 0 && qty > 0) {
                for (let q = 0; q < qty; q++) {
                    partReals.push(real);
                    partNames.push(document.getElementById("p" + i + "Name").value || ("Part " + i));
                }
            }
        }

        const calc = calculateInvoice(partReals, desiredProfit, tRate);

        const invoiceMeta = {
            company: document.getElementById("companyName").value || "Wilson & Myers Appliance Repairs",
            number: document.getElementById("invoiceNumber").value,
            date: document.getElementById("invoiceDate").value
        };

        const clientData = {
            name: document.getElementById("clientName").value,
            phone: document.getElementById("clientPhone").value,
            address: document.getElementById("clientAddress").value
        };

        renderInvoice(partNames, calc, clientData, invoiceMeta);
    });

    // EASY —Ä–µ–∂–∏–º
    document.getElementById("btnGenerateEasy").addEventListener("click", function () {
        const desiredProfit = toNumber(document.getElementById("easyProfit").value);
        const tRate = toNumber(easyTaxInput.value || "7.96");

        const partReals = [];
        const partNames = [];

        const easyIds = ["e1Real", "e2Real", "e3Real", "e4Real", "e5Real"];

        easyIds.forEach(function (id, idx) {
            const val = toNumber(document.getElementById(id).value);
            if (val > 0) {
                partReals.push(val);
                partNames.push("Part " + (idx + 1));
            }
        });

        const calc = calculateInvoice(partReals, desiredProfit, tRate);

        const invoiceMeta = {
            company: document.getElementById("companyName").value || "Wilson & Myers Appliance Repairs",
            number: document.getElementById("invoiceNumber").value,
            date: document.getElementById("invoiceDate").value
        };

        const clientData = {
            name: document.getElementById("clientName").value,
            phone: document.getElementById("clientPhone").value,
            address: document.getElementById("clientAddress").value
        };

        renderInvoice(partNames, calc, clientData, invoiceMeta);
    });
})();
</script>
</body>
</html>
